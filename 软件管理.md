# 软件管理  
基于主要交互方式的不同，Linux平台和windows平台的软件安装也相应的不同。Linux软件的安装很少是通过在窗口点击几次下一步实现的，而是通过命令告诉你的系统，让系统自行处理安装操作，只有少数至关重要的操作需要你亲自做决定。比如你只需要输入`pip install numpy`就可以安装好优秀的矩阵运算包numpy。  
但这并不意味着Linux软件的安装是更为轻松的。抛却shell界面不如图形界面用户友好不说，大多数情况下Linux软件都有复杂的依赖关系，这是由软件的开源特性决定的。例如：你想要开发一个之前没有人开发过的工具，为了节省时间，一个很自然的想法是先试着找一些开源支持包，从中找到可以直接调用的程序接口，由此你的工具便和该支持包有了依赖关系。具体表现就是另一个人若想安装和使用你的工具，他必须同时安装被你调用的支持包。想象一下随着自由软件的流行，程序之间的依赖关系如同树形结构一般越来越复杂，A依赖B，B依赖C和D，C和D又分别依赖E、F和G、H，某一个用户为了安装A就得安装7个依赖包，他不得不从最底层的依赖包一个个安装，付出的时间成本将是巨大的。因此**为解决软件依赖关系而生的包管理器**的出现是必然的，包管理器成为主流也是大势所趋，所以我们要讨论的软件安装与我们所使用的包管理器密切相关。在讨论安装的具体操作之前，我们需要了解常用的包管理器。  
## 包管理器  
在自由软件的世界向前发展的过程中，为了用户使用方便，开发人员们为用户开发了各种各样的包管理器。包管理器可以使软件的安装简单化，但另一方面由于自由软件太过“自由”，出现了各种易用程度不尽相同的包管理器，每个包管理器都有自己的用法。比较著名的包管理器有yum、apt、pacman、aur、pip、conda和portage等。基于我先前的推荐，此篇中我们将主要讨论**yum、apt、pip和conda**这四个包管理器。

**yum**是由redhat开发的包管理器，主要被redhat系发行版，即red hat enterprise linux、centos和fedora等发行版采用。如果您有兴趣详细地了解它，请参阅由redhat编写的documentation中的[Chapter 14](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/deployment_guide/c1-yum)  
**apt**是由debian开发的包管理器，主要被debian系发行版，即debian、Ubuntu、elementaryos等发行版采用。如果您有兴趣详细地了解它，请参阅由Wikipedia词条[APT](https://zh.wikipedia.org/wiki/APT)及debian编写的说明文档[APT](https://wiki.debian.org/zh_CN/Apt)  
**pip**是由Python开发团队开发的包管理器，从Python3开始就默认提供了，这意味着只要您安装了Python3以上的版本，您就可以直接通过pip管理软件了。如果您有兴趣详细地了解它，请参阅由pypi提供的[Project description](https://pypi.org/project/pip/)。
> 此外，需要注意的是pip2与pip3可以同时共存，但pip2安装的软件不能同时用于pip3，也就是说如果某个程序是基于Python3编写的，那么你不能用pip2安装适用于该程序的依赖包。我们将在随后的问题解决当中再次提到这个问题。  

**conda**是由Continuum Analytics开发的包管理器，适用于管理Python, R, Node.js和Java等编写的程序的包管理，其不被任何编程语言默认提供。只能通过安装Anaconda或Miniconda来启用它。如果您有兴趣详细地了解它，请参阅由Anaconda提供的[说明文档](https://docs.conda.io/en/latest/)  
## 软件管理  
软件安装的具体操作与使用的包管理器密切相关。  
**你应当把这三个部分按照需要进行替换：**
```
[packagename]：要安装的软件名称 
[envname]: 要操作的environment 
[keyword]：检索关键词`
```

### 使用yum
```
  yum search [keyword] # 搜索
  yum install [packagename] # 安装
  yum check-update # 查找更新
  yum update # 更新所有软件
  yum update [packagename] # 更新单个软件
  yum remove [packagename] # 卸载
```    
示例：  
```
  yum search git
  yum install git
  yum update git
  yum remove git
```    
### 使用apt
```
  apt-cache search [keyword] # 搜索
  apt-get install [packagename] # 安装
  apt-get remove [packagename] # 卸载
  apt-get update # 从软件源更新软件列表
  apt-get upgrade # 更新所有软件
```
示例：
```   
  apt-cache search git
  apt-get install git
  apt-get remove git
```
### 使用pip   
```  
  pip --version # 查看已安装的pip版本
  pip --help # 查看官方提供的帮助文档
  pip search [packagename] # 查询
  pip install [packagename] # 安装
  pip install --upgrade [packagename] # 升级
  pip uninstall [packaganame] # 卸载
  pip list # 列出所有已安装的包
  pip list -o # 仅列出可升级的包
    
```  
示例：
```  
  pip search numpy
  pip install numpy
  pip install --upgrade numpy
  pip uninstall numpy
```  
### 使用conda  
```   
  conda --help # 查看帮助文档
  conda search [keyword] # 搜索
  conda install [packagename] # 安装
  conda update [packagename] # 升级 
  conda remove [packagename] # 卸载
  conda list # 查看已安装的所有包
```  
示例：
```
  conda search scipy
  conda install scipy
  conda update scipy
  conda remove scipy
```
conda是一个很特殊的包管理器，除了管理包之外，它还能管理**虚拟环境（environment）**。下面这一段关于environment的说明引自conda的官方文档。  

> A conda environment is a directory that contains a specific collection of conda packages that you have installed. For example, you may have one environment with NumPy 1.7 and its dependencies, and another environment with NumPy 1.6 for legacy testing. If you change one environment, your other environments are not affected. You can easily activate or deactivate environments, which is how you switch between them. You can also share your environment with someone by giving them a copy of your environment.yaml file.   

简单来说，conda的虚拟环境能够允许你在不同的虚拟环境下安装同一个软件的不同版本。  
conda默认安装的包即是在默认的虚拟环境里面，如果你没有激活该默认虚拟环境，你将无法正常使用由conda安装的包。因此，我们在此处有必要拓展conda的用法，通常使用如下的命令来管理虚拟环境：  

``` 
  conda create --name [envname] # 创建虚拟环境
  conda install -n [envname] [packagename] # 为指定的虚拟环境安装 包
  conda create -n [envname] python # 用某个包创建虚拟环境
  conda create -n [envname] python=3.5 # 用某个包的特定版本创建虚拟环境
  conda info -e # 列出所有的虚拟环境
  conda activate [envname] # 激活虚拟环境
  deactivate # 退出
  conda remove -n [envname] --all # 删除虚拟环境
```  
### 手动安装  
包管理器的出现固然能为我们使用 Linux 提供很大帮助，但毕竟它们是面向所有 Linux 用户的，因此并不包含所有生信人常用的工具。事实上，包管理器无法解决我们遇到的所有软件问题，虽然它们能够为我们节省时间，但仅限于它们能解决的部分。剩下的部分，我们需要亲自动手，它依然是充满挑战性的。但不用担心，问题一旦解决，亲自解决问题的成就感和积累的宝贵经验都属于你。当然，代价是你得进行多次尝试，这需要大量的时间和劳动力，以及屡次失败但依然坚持寻找问题根源的毅力。   
为了理解软件安装过程的方便，你需要了解软件开发的全过程，以下是一个简要的软件开发流程示意图。
![Github](https://github.com/ChongHui-007/Linux-recipe-for-BMC-learners/blob/master/material/dev.jpg)  
从图中可以看出，计算机能够运行的文件一定是编译好的二进制文件，而开发人员们写的通常是工程代码，计算机不能直接运行这些工程代码。因此，大多数时候我们都要判断自己得到的是源文件还是二进制文件，据此判断是否需要先编译再执行。  
我们将会通过tophat的安装让你了解手动安装的全过程，希望你有所收获。  
#### 直接安装  
tophat是生物信息学转录组分析的传统三件套（bowtie tophat cufflinks）之一，由约翰霍普斯金大学提供。它提供了预先编译好的包，这一类包不需要进行编译就可以直接安装和使用了。  
``` 
  wget -c https://ccb.jhu.edu/software/tophat/downloads/tophat-2.1.1.Linux_x86_64.tar.gz # 下载安装包
  tar xvfz tophat-2.1.1.Linux_x86_64.tar.gz # 解压
  mv tophat-2.1.1.Linux_x86_64 env/ # 移动到安装目录
  cd env/tophat-2.1.1.Linux_x86_64
  ./tophat -v # 启动，./是当前目录的意思，不能省略
```
到目前为止，tophat已经可以在安装目录下正常启动了。  
如果你想要在任何目录下都可以启动它，有两种比较好的解决方案：
1. 编辑.bashrc，在**文件末尾**添加别名（仅对你自己生效，[安装目录]为[绝对路径](https://www.baidu.com/)）
```
  vim ~/.bashrc
  # 添加内容：alias tophat='[安装目录]/tophat-2.1.1.Linux_x86_64/tophat'
  source ~/.bashrc
```
2. 将安装目录添加到PATH(以下两种选一种)
```
  # 只对你自己生效
  vim ~/.bashrc
  # 添加内容：export PATH=[安装目录]/tophat-2.1.1.Linux_x86_64/:$PATH
  source ~/.bashrc # 立刻生效
```
---
```
  # 对所有用户生效
  sudo vim /etc/profile
  # 添加内容：export PATH=[安装目录]/tophat-2.1.1.Linux_x86_64/:$PATH
  # 重启系统后生效
```

#### 手动编译  
tophat也提供了源码包，此类型的包需要编译才能在系统上运行。  
```
  wget -c https://ccb.jhu.edu/software/tophat/downloads/tophat-2.1.1.tar.gz # 下载
  tar xvfz tophat-2.1.1.tar.gz # 解压
  cd tophat-2.1.1
  # 开始编译
  ./configure --prefix=/path/to/tophat_base_dir --with-boost=/path/to/boost_prefix_dir # 需要预先安装包boost
  make
  make install
  cd bin
  ./tophat -v # 运行tophat，./不能省略
```
同样的，此时tophat已经可以在安装目录的bin文件夹下运行了。  
如果想要在任何目录都可以启动tophat，添加别名和添加到PATH两种解决方案依然适用，只是**要添加的目录应改为[安装目录]/tophat-2.1.1/bin/**。  
## 配置软件源   

世界各地都有研究机构同步主流的开源软件源代码或安装包，也为各大主流 Linux发行版提供软件源镜像，目的就是为了给用户提供更快的下载速度。国内软件源最丰富的是中国科学技术大学镜像站点。在该站点，他们提供了可读性很好的软件源更换教程。如有需要请访问：[中国科学技术大学](http://mirrors.ustc.edu.cn/help/)

